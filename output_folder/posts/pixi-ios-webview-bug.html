<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Strange Bug in iOS Webview</title>
  <link href="../assets/images/favicon.png" rel="icon">
  <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>

<div class="content">
  <h1 class="title">Strange Bug in iOS Webview</h1>
  <hr>
  <small>
    [<a href="../index.html">homepage</a>] 
    [<a href="./index.html">index</a>] 
  </small>
  <hr>
  <span class="title-info" style="color: #000;">Chengzhi Yang</span>
  <span class="title-info" style="margin-left: 10px;">2017-04-21</span>
  <div class="paragraph">
    <p>I&rsquo;m working on an HTML 5 web game, need to compatible with the iOS device. It&rsquo;s used the PIXI.js for render engine. Game detect the browser window size to suit different resolutions and different orientations for mobile. Everything works well on develop phase, but when I test it in real iOS device weird bug occurs&hellip;</p>

<p>This game is full page display, works well on Safari browser. But in another browser like Chrome, it will get the wrong size of the current window. This happened on resize event triggered, for the mobile browser, it&rsquo;s orientation change. For my situation I get the windows size [width1, height1] for the first time this is correct values, the game works fine on the point. But after an orientation change I get [width2, height2] it&rsquo;s wrong values!! it&rsquo;s far more small than the real window size, and if device rotates back [width1, height1] is expected but it will get [width3, height3] also smaller wrong values. It&rsquo;s wired and confusing!</p>

<p>With my friend&rsquo;s help who is a web dev guy, I solved the bug by a magic way. He gives me a thought wich use an invisible huge size container to inflate the page. Puff! The bug is gone!</p>

<p>Juse add this magic code to the page:</p>

<pre><code class="language-html">&lt;!--Deal with iOS WebView Bug.--&gt;
&lt;div id=&quot;Magic&quot; style=&quot;width:2000px;height:2000px;overflow:hidden;&quot;&gt;&lt;/div&gt;
</code></pre>

<p>This is a full test page code, test_rotate.html</p>

<pre><code class="language-html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;test-rotate&lt;/title&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot; /&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,height=device-height,initial-scale=1.0&quot;/&gt;

  &lt;script src=&quot;pixi.min.js&quot;&gt;&lt;/script&gt;

&lt;/head&gt;
&lt;body style='margin:0;'&gt;
  &lt;script&gt;
    var size = [1280, 600];
    var rsize = [0, 0];

    size[0] = window.innerWidth;
    size[1] = window.innerHeight;
    var renderer = PIXI.autoDetectRenderer(size[0], size[1], {antialias: false, transparent: false, resolution: 1});
    document.body.appendChild(renderer.view);

    var stage = new PIXI.Stage(0x000000, true);

    function resize() {
      var w = window.innerWidth;
      var h = window.innerHeight;
      
      renderer.resize(w, h);
      //alert(&quot;resize1 &quot; + w + &quot; &quot; + h +  ' ?' + screen.width + ' ' + screen.height);

      console.log(&quot;resize&quot;, w, h);
    }
    window.onresize = resize;

    requestAnimationFrame(gameLoop);
    resize();

    function gameLoop() {
      requestAnimationFrame(gameLoop);
      renderer.render(stage);
    }

  &lt;/script&gt;
  &lt;!--Deal with iOS WebView Bug.--&gt;
  &lt;div id=&quot;Magic&quot; style=&quot;width:2000px;height:2000px;overflow:hidden;&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

  </div>
</div>
</body>
</html>
